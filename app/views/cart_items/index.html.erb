<% @items_with_quantities.each do |item, quantity| %>
  <%= render partial: 'item', locals: { item: item, quantity: quantity } %>
<% end %>

<h3>Total: $<%= @total %></h3>

<div class="row">
  <% if current_user %>
    <%= form_tag user_orders_path(current_user), id: 'stripe-form' do %>
      <article>
        <% if flash[:error].present? %>
          <div id="error_explanation">
            <p><%= flash[:error] %></p>
          </div>
        <% end %>
      </article>

      <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
              data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
              data-description="Art from Rough Sketch"
              data-amount="<%= @total * 100 %>"
              data-locale="auto"></script>

      <button class="waves-effect waves-light btn green accent-4" id="checkout">Checkout</button>
    <% end %>
  <% else %>
    <%= button_to "Checkout", login_path, method: :get, :class=> "waves-effect waves-light btn green accent-4" %>
  <% end %>
</div>
